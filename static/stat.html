<!DOCTYPE HTML>
<html>
	<head>
		<title>flex:stat</title>
		<meta charset="utf-8" />
		<meta http-equiv="Cache-Control" content="no-store" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />



		<link rel="stylesheet" href="assets/css/main.css" />
	
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
	</head>

	<style>
		body{
		    width:90%;
		    margin:50px auto;
		}
		path {  stroke: #fff; }
		path:hover {  opacity:0.9; }
		rect:hover {  fill:blue; }
		.axis {  font: 10px sans-serif; }
		.legend tr{    border-bottom:1px solid grey; }
		.legend tr:first-child{    border-top:1px solid grey; }

		.axis path,
		.axis line {
		  fill: none;
		  stroke: #fff;
		  shape-rendering: crispEdges;
		}

		.x.axis path {  display: none; }
		.legend{
		    margin-bottom:76px;
		    display:inline-block;
		    border-collapse: collapse;
		    border-spacing: 0px;
		}
		.legend td{
		    padding:4px 5px;
		    vertical-align:bottom;
		}
		.legendFreq, .legendPerc{
		    align:right;
		    width:50px;
		}  /*This is styling for the D3*/

	</style>
		<!-- Header -->
			<header id="header">
			</header><br>

	<body scroll="no" scrolling="no">
				<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>

				<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	
			<div></div>
			<br>
			<br>
			<br>
			<div id="user" align="center">
				<h1><i class="fa fa-user"></i> Welcome, Julie</h1>
			</div>
			<br>



			</div>
			<br> 

			<div id='dashboard' align="center" style="">
				<table style="width:100%">
					<tr> 
						<td> 
							<canvas id="myChart" width="400" height="400"></canvas>
						</td>
						<td> 
							<!-- <canvas id="myChart1" width="400" height="400"></canvas> -->

						</td>  
					</tr>
				</table>
				
			</div> 
			</br>


			<div id="spoiler"> 

				<a class="show"><img id="close" src="images/x.png"></a>
<!-- 
				onclick="close(); if(document.getElementById('spoiler') .style.display=='none') {document.getElementById('spoiler') .style.display=''}else{document.getElementById('spoiler') .style.display='none'}" -->

				<p id="tip">You could be saving $500.00 a month if you don't eat out!</p>
			</div> 
			<br>

 			<div id="map">
 				
 			</div>
 			<br>

			<div id='buttons' align="center">
				<tr>
					<button class="button" onclick="category('fineDining')">Fine Dining</button>
					<button class="button" onclick="category('fastFood')">Fast Food</button>
					<button class="button" onclick="category('apparelOnline')">Apparel Online</button>
					<button class="button" onclick="category('electronicsOnline')">Electronics Online</button>
					<button class="button" onclick="category('generalMerchandiseOnline')">General Merchandise</button>
					<button class="button" onclick="category('homeGoodsOnline')">Home Goods</button>
					<button class="button" onclick="category('sportingGoodsOnline')">Sporting Goods</button>
					<button class="button" onclick="category('hardware')">Hardware</button>
					<button class="button" onclick="category('apparel')">Clothes</button>

				</tr>
			</div>
	
			<br>

			<div id='titles' align="center">  
				<div class="summarytable">
					 <table class="head">
					        <tr>
					            <td><h2><i class="fa fa-shopping-cart"></i> Retailer</h2></td>
					            <td><h2><i class="fa fa-credit-card"></i> Amount Paid</h2></td>
					            <td><h2><i class="fa fa-calendar"></i> Date</h2></td>
					        </tr>
					    </table>
				</div>
			</div>

			<div id='categories' align="center">  
				<div class="summarytable">
					 <table class="head">
					    </table>
					<table id="mytable"></table>
				</div>
			</div>



		<!-- Scripts -->
			<!-- [if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif] -->
			<script src="assets/js/main.js"></script>
			<script src="assets/js/Chart.min.js"></script>
			<script src"assets/js/flexmap.js" ></script>



			<!-- These are the scripts to make D3 work.  Will need editing.  I changed the text color so far to show on our layout -->

			<script src="http://d3js.org/d3.v3.min.js"></script>
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
			<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
			<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>





			<script type="text/javascript">
				$('a.show').on('click', function () {
				    $('#spoiler').toggle("slide", { direction: "left" }, 1000);
				});
			</script>

<!-- 			<script>
				var xmlhttp = new XMLHttpRequest();
				var url = "/refresh_food";
				xmlhttp.open("GET", url, true);
				xmlhttp.send();
			</script>
			<script>
				var xmlhttp = new XMLHttpRequest();
				var url = "/refresh_retail";
				xmlhttp.open("GET", url, true);
				xmlhttp.send();
			</script>
			<script>
				var xmlhttp = new XMLHttpRequest();
				var url = "/refresh_online";
				xmlhttp.open("GET", url, true);
				xmlhttp.send();
			</script> -->

			<script>
				// function convC1Data(id, food, retail, online) {
				//     var foodSum = 0.0; 
				//     for(i = 0; i < food.length; i++) {
				//     	foodSum += food[i]['price']
				//     }
				//     console.log(foodSum)

				//     var retailSum = 0.0; 
				//     for(i = 0; i < retail.length; i++) {
				//     	retailSum += retail[i]['price']
				//     }
				//     console.log(retailSum)

				//     var onlineSum = 0.0; 
				//     for(i = 0; i < online.length; i++) {
				//     	onlineSum += online[i]['price']
				//     }
				//     console.log(onlineSum)

				//     var pD = []

				//     var food = {type: "Food", freq: foodSum.toFixed(2)}
				//     pD.push(food)

				//     var online = {type: "online", freq: onlineSum.toFixed(2)}
				//     pD.push(online)

				//     var retail = {type: "retail", freq: retailSum.toFixed(2)}
				//     pD.push(retail)

				//     // For a pie chart
				//    // Get context with jQuery - using jQuery's .get() method.
				// 	var ctx = $("#myChart").get(0).getContext("2d");
				// 	// This will get the first returned node in the jQuery collection.
				// }


					var populatedData = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
 
					$.getJSON('/purchases', function(data) {
						for(i = 0; i < data.length; i++) {
								switch(data[i]['description']) {
									case "fastFood": 
										populatedData[0] += Number(data[i]['price']);
									case "fineDining": 
										populatedData[1] += Number(data[i]['price']);
									case "apparelOnline": 
										populatedData[2] += Number(data[i]['price']);
									case "electronicsOnline": 
										populatedData[3] += Number(data[i]['price']);
									case "electronicsOnline": 
										populatedData[4] += Number(data[i]['price']);
									case "homeGoodsOnline": 
										populatedData[5] += Number(data[i]['price']);
									case "sportingGoodsOnline": 
										populatedData[6] += Number(data[i]['price']);
									case "hardware": 
										populatedData[7] += Number(data[i]['price']);
									case "apparel": 
										populatedData[8] += Number(data[i]['price']);
							}
						}

					var sum = 0.0; 
					for(i = 0; i < populatedData.length; i++) {
						sum += Number(populatedData[i]); 
					}
					for(i = 0; i < populatedData.length; i++) {
						populatedData[i] = Number(populatedData[i]) / sum; 
						populatedData[i] = populatedData[i].toFixed(2) * 10; 
					}

					var data = {
					    labels: ["Fast Food", "Fine Dining", "Online Apparel", "Online Electronics", "Online Merchandise", "Online Home Goods", "Online Sporting Goods", "Computer Hardware", "Apparel"],
					    datasets: [
					        {
					            label: "My Expenditures",
					            fillColor: "rgba(220,220,220,0.2)",
					            strokeColor: "#fff",
					            pointColor: "#fff",
					            pointStrokeColor: "#fff",
					            pointHighlightFill: "#fff",
					            pointHighlightStroke: "#fff",
					            data: populatedData
					        }
					    ]
					};

					var options = {
					    //Boolean - Whether to show lines for each scale point
					    scaleShowLine : true,

					    //Boolean - Whether we show the angle lines out of the radar
					    angleShowLineOut : false,

					    //Boolean - Whether to show labels on the scale
					    scaleShowLabels : false,

					    // Boolean - Whether the scale should begin at zero
					    scaleBeginAtZero : true,

					    //String - Colour of the angle line
					    angleLineColor : "rgba(220,220,220,0.2)",

					    //Number - Pixel width of the angle line
					    angleLineWidth : 1,

					    //String - Point label font declaration
					    pointLabelFontFamily : "'Arial'",

					    //String - Point label font weight
					    pointLabelFontStyle : "normal",

					    //Number - Point label font size in pixels
					    pointLabelFontSize : 10,

					    //String - Point label font colour
					    pointLabelFontColor : "#fff",

					    //Boolean - Whether to show a dot for each point
					    pointDot : true,

					    //Number - Radius of each point dot in pixels
					    pointDotRadius : 3,

					    //Number - Pixel width of point dot stroke
					    pointDotStrokeWidth : 1,

					    //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
					    pointHitDetectionRadius : 20,

					    //Boolean - Whether to show a stroke for datasets
					    datasetStroke : true,

					    //Number - Pixel width of dataset stroke
					    datasetStrokeWidth : 2,

					    //Boolean - Whether to fill the dataset with a colour
					    datasetFill : true,

					    //String - A legend template
					    legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].strokeColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"
					}; 

				// Get context with jQuery - using jQuery's .get() method.
				var ctx = $("#myChart").get(0).getContext("2d");
				var myNewChart = new Chart(ctx).Radar(data, options);
					}); 

				canvas.onclick = function(evt){
					    var activePoints = myLineChart.getPointsAtEvent(evt);
					    // => activePoints is an array of points on the canvas that are at the same position as the click event.
					    console.log("Hello")
					};





			</script>

			<script>
				function category(cat){

					$.getJSON('/purchases', function(data) {

					$('#mytable tr').remove();

    
        					$.each(data, function(i, item) {
        						if (item.description == cat){
		    					$row = $('<tr></tr>');
		    					$row.append('<td>' + item.name.charAt(0).toUpperCase() + item.name.slice(1) + '</td>');
							$row.append('<td>' + "$" + parseInt(item.price).toFixed(2) + '</td>');
							$row.append('<td>' + new Date(item.date) + '</td>');

							// repeat the above line for each data item

							$('#mytable').append($row);
						}
					})

					});
				}


					$.getJSON('/purchases', function(data) {

					$('#mytable tr').remove();

    
        					$.each(data, function(i, item) {
		    					$row = $('<tr></tr>');
		    					$row.append('<td>' + item.name.charAt(0).toUpperCase() + item.name.slice(1) + '</td>');
							$row.append('<td>' + "$" + parseInt(item.price).toFixed(2) + '</td>');
							$row.append('<td>' + new Date(item.date) + '</td>');

							// repeat the above line for each data item

							$('#mytable').append($row);
					})

					});



				
				var food = []
				var retail = []
				var online = []
				$.getJSON('/purchases', function(data) {
    					//data is the JSON string
    					
    					for(i = 0; i < data.length;i++) {
    						// console.log(data[i]); 
    					}

    					for(i = 0; i < 10; i++) {
    						food.push(data[i])
    					}

    					for(i = 10; i < 20; i++) {
    						retail.push(data[i])
    					}

    					for(i = 10; i < 20; i++) {
    						online.push(data[i])
    					}

    					// convC1Data("#dashboard", food, online, retail)
				});

			</script>

	</body>

				<!-- Footer -->
			<footer id="footer">
				<ul class="icons">
					<li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
					<li><a href="#" class="icon fa-github"><span class="label">GitHub</span></a></li>
					<li><a href="#" class="icon fa-envelope-o"><span class="label">Email</span></a></li>
				</ul>
				<ul class="copyright">
					<li>&copy; flex <br>Made with <i class="fa fa-heart"></i> at VT Hacks III </li><li><br>John Purviance | Jayanth Prathipati | Oliver Ebeling-Koning | Dag Yeshiwas</li>
				</ul>
			</footer>

</html>
