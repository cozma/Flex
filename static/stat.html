<!DOCTYPE HTML>
<html>
	<head>
		<title>flex:stat</title>
		<meta charset="utf-8" />
		<meta http-equiv="Cache-Control" content="no-store" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />



		<link rel="stylesheet" href="assets/css/main.css" />
	
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
	</head>

	<style>
		body{
		    width:90%;
		    margin:50px auto;
		}
		path {  stroke: #fff; }
		path:hover {  opacity:0.9; }
		rect:hover {  fill:blue; }
		.axis {  font: 10px sans-serif; }
		.legend tr{    border-bottom:1px solid grey; }
		.legend tr:first-child{    border-top:1px solid grey; }

		.axis path,
		.axis line {
		  fill: none;
		  stroke: #fff;
		  shape-rendering: crispEdges;
		}

		.x.axis path {  display: none; }
		.legend{
		    margin-bottom:76px;
		    display:inline-block;
		    border-collapse: collapse;
		    border-spacing: 0px;
		}
		.legend td{
		    padding:4px 5px;
		    vertical-align:bottom;
		}
		.legendFreq, .legendPerc{
		    align:right;
		    width:50px;
		}  /*This is styling for the D3*/

	</style>
		<!-- Header -->
			<header id="header">
			</header><br>

	<body scroll="no" scrolling="no">

				<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>

				<br>	<br>	<br>	<br>	<br>	<br> <br> <br>
			<br>
			<br>
			<div id="user" align="center">
				<h1><i class="fa fa-user"></i> Welcome, Julie</h1></br>
				<p>Understand Your Spending</p>

			</div>
			<br>


 			<div id="map">
 				
 			</div>

 			<br>

 			<div id="spoiler"> 

				<a class="show"><img id="close" src="images/x.png"></a>
<!-- 
				onclick="close(); if(document.getElementById('spoiler') .style.display=='none') {document.getElementById('spoiler') .style.display=''}else{document.getElementById('spoiler') .style.display='none'}" -->

				You spent $<span id="total"></span> last pay cycle.  Check out where you can save more.
			</div> 

			<br id="hide_me">



			<div id='dashboard' align="center" style="">
				<table style="width:100%">
					<tr> 
						<td> 
							<div style="max-width: 400px;">
								<canvas id="myChart" width="400" height="400" style="float: left;"></canvas>
							</div>
							
						</td>
						<td> 
							<div style="max-width: 400px;">
								<canvas id="myChart1" width="400" height="400" style="float: left;"></canvas>
							</div>
						</td>  
					</tr>
				</table>
				
			</div> 
			</br>


			<div id='buttons' align="center">
				<tr>
					<button class="button" onclick="category('fineDining')">Fine Dining</button>
					<button class="button" onclick="category('fastFood')">Fast Food</button>
					<button class="button" onclick="category('apparelOnline')">Apparel Online</button>
					<button class="button" onclick="category('electronicsOnline')">Electronics Online</button>
					<button class="button" onclick="category('generalMerchandiseOnline')">General Merchandise</button>
					<button class="button" onclick="category('homeGoodsOnline')">Home Goods</button>
					<button class="button" onclick="category('sportingGoodsOnline')">Sporting Goods</button>
					<button class="button" onclick="category('hardware')">Hardware</button>
					<button class="button" onclick="category('apparel')">Clothes</button>

				</tr>
			</div>
	
			<br>


			<div id='titles' align="center">  
				<div class="summarytable">
					 <table class="head">
					        <tr>
					            <td><h2><i class="fa fa-shopping-cart"></i> Retailer</h2></td>
					            <td><h2><i class="fa fa-credit-card"></i> Amount Paid</h2></td>
					            <td><h2><i class="fa fa-calendar"></i> Date</h2></td>
					        </tr>
					    </table>
				</div>
			</div>

			<div id='categories' align="center">  
				<div class="summarytable">
					 <table class="head">
					    </table>
					<table id="mytable"></table>
				</div>
			</div>




		<!-- Scripts -->
			<!-- [if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif] -->
			<script src="assets/js/main.js"></script>
			<script src="assets/js/Chart.min.js"></script>
			<script src"assets/js/flexmap.js" ></script>



			<!-- These are the scripts to make D3 work.  Will need editing.  I changed the text color so far to show on our layout -->

			<script src="http://d3js.org/d3.v3.min.js"></script>
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
			<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
			<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>



			<script type="text/javascript">
			$.getJSON('/gis', function(data){
				var map = L.map('map').setView([37.2300, -80.4178], 15);
				map.attributionControl = false;
				map.scrollWheelZoom.disable();
				L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);
				// L.marker([37.2300, -80.4178]).addTo(map);

				$.each(data, function(i, item){
				
					L.marker(item).addTo(map).bindPopup("<p style='color:black'>"+String(i)+"</p>");
				});
			});


			</script>

			<script type="text/javascript">
				$('a.show').on('click', function () {
				    $('#spoiler').toggle("slide", { direction: "left" }, 1000);
				    $('#hide_me').toggle("slide", { direction: "left" }, 1000);

				});
			</script>



<!-- 			<script>
				var xmlhttp = new XMLHttpRequest();
				var url = "/refresh_food";
				xmlhttp.open("GET", url, true);
				xmlhttp.send();
			</script>
			<script>
				var xmlhttp = new XMLHttpRequest();
				var url = "/refresh_retail";
				xmlhttp.open("GET", url, true);
				xmlhttp.send();
			</script> 
			<script>
				var xmlhttp = new XMLHttpRequest();
				var url = "/refresh_gis";
				xmlhttp.open("GET", url, true);
				xmlhttp.send();
			</script> -->

			<script>
				// function convC1Data(id, food, retail, online) {
				//     var foodSum = 0.0; 
				//     for(i = 0; i < food.length; i++) {
				//     	foodSum += food[i]['price']
				//     }
				//     console.log(foodSum)

				//     var retailSum = 0.0; 
				//     for(i = 0; i < retail.length; i++) {
				//     	retailSum += retail[i]['price']
				//     }
				//     console.log(retailSum)

				//     var onlineSum = 0.0; 
				//     for(i = 0; i < online.length; i++) {
				//     	onlineSum += online[i]['price']
				//     }
				//     console.log(onlineSum)

				//     var pD = []

				//     var food = {type: "Food", freq: foodSum.toFixed(2)}
				//     pD.push(food)

				//     var online = {type: "online", freq: onlineSum.toFixed(2)}
				//     pD.push(online)

				//     var retail = {type: "retail", freq: retailSum.toFixed(2)}
				//     pD.push(retail)

				//     // For a pie chart
				//    // Get context with jQuery - using jQuery's .get() method.
				// 	var ctx = $("#myChart").get(0).getContext("2d");
				// 	// This will get the first returned node in the jQuery collection.
				// }
				function getRandomIntInclusive(min, max) {
  					return Math.floor(Math.random() * (max - min + 1)) + min;
				}

					var populatedData = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
					var fastFood = {};
					var fineDining = {};
					var apparelOnline = {};
					var electronicsOnline = {};
					var merchandiseOnline = {};
					var homeGoodsOnline = {};
					var sportingGoodsOnline = {};
					var hardware = {};
					var apparel = {};
 
					$.getJSON('/purchases', function(data) {
						for(i = 0; i < data.length; i++) {
								switch(data[i]['description']) {
									case "fastFood": 
									    if(fastFood.hasOwnProperty(data[i]['name'])){
									    	var cost = fastFood['name']; 
									    	fastFood[data[i]['name']]  = cost += data[i]['price']; 
										}
										else {
											fastFood[data[i]['name']]  = data[i]['price']; 
										}
										populatedData[0] += Number(data[i]['price']);
									case "fineDining": 
									    if(fineDining.hasOwnProperty(data[i]['name'])){
									    	var cost = fastFood['name']; 
									    	fineDining[data[i]['name']]  = cost += data[i]['price']; 
										}
										else {
											fineDining[data[i]['name']]  = data[i]['price']; 
										}
										populatedData[1] += Number(data[i]['price']);
									case "apparelOnline":
									    if(apparelOnline.hasOwnProperty(data[i]['name'])){
									    	var cost = fastFood['name']; 
									    	apparelOnline[data[i]['name']]  = cost += data[i]['price']; 
										}
										else {
											apparelOnline[data[i]['name']]  = data[i]['price']; 
										}
										populatedData[2] += Number(data[i]['price']);
									case "electronicsOnline": 
									    if(electronicsOnline.hasOwnProperty(data[i]['name'])){
									    	var cost = fastFood['name']; 
									    	electronicsOnline[data[i]['name']]  = cost += data[i]['price']; 
										}
										else {
											electronicsOnline[data[i]['name']]  = data[i]['price']; 
										}
										populatedData[3] += Number(data[i]['price']);
									case "merchandiseOnline": 
									    if(merchandiseOnline.hasOwnProperty(data[i]['name'])){
									    	var cost = fastFood['name']; 
									    	merchandiseOnline[data[i]['name']]  = cost += data[i]['price']; 
										}
										else {
											merchandiseOnline[data[i]['name']]  = data[i]['price']; 
										}
										populatedData[4] += Number(data[i]['price']);
									case "homeGoodsOnline": 
									    if(homeGoodsOnline.hasOwnProperty(data[i]['name'])){
									    	var cost = fastFood['name']; 
									    	homeGoodsOnline[data[i]['name']]  = cost += data[i]['price']; 
										}
										else {
											homeGoodsOnline[data[i]['name']]  = data[i]['price']; 
										}
										populatedData[5] += Number(data[i]['price']);
									case "sportingGoodsOnline": 
									    if(sportingGoodsOnline.hasOwnProperty(data[i]['name'])){
									    	var cost = fastFood['name']; 
									    	sportingGoodsOnline[data[i]['name']]  = cost += data[i]['price']; 
										}
										else {
											sportingGoodsOnline[data[i]['name']]  = data[i]['price']; 
										}
										populatedData[6] += Number(data[i]['price']);
									case "hardware": 
									    if(hardware.hasOwnProperty(data[i]['name'])){
									    	var cost = fastFood['name']; 
									    	hardware[data[i]['name']]  = cost += data[i]['price']; 
										}
										else {
											hardware[data[i]['name']]  = data[i]['price']; 
										}
										populatedData[7] += Number(data[i]['price']);
									case "apparel": 
									    if(apparel.hasOwnProperty(data[i]['name'])){
									    	var cost = fastFood['name']; 
									    	apparel[data[i]['name']]  = cost += data[i]['price']; 
										}
										else {
											apparel[data[i]['name']]  = data[i]['price']; 
										}
										populatedData[8] += Number(data[i]['price']);
							}
						}

					var sum = 0.0; 
					for(i = 0; i < populatedData.length; i++) {
						sum += Number(populatedData[i]); 
					}
					for(i = 0; i < populatedData.length; i++) {
						populatedData[i] = Number(populatedData[i]) / sum; 
						populatedData[i] = populatedData[i].toFixed(2) * 10; 
					}

					var keysToGet = Object.keys(apparel);
					var keys = []
					var values = []
					for(i = 0; i < 10; i++) {
						var index = getRandomIntInclusive(0, keysToGet.length); 
						if(apparel[keysToGet[index]] == 'undefined') {
							console.log(apparel[keysToGet[index]] ); 
						}
						else if(isNaN(apparel[keysToGet[index]])) {
							index = getRandomIntInclusive(0, keysToGet.length); 
						}
						// if(!isNaN(apparel[keys[index]]) && ) {
						// 	console.log("Tjis is running"); 
						// 	index = getRandomIntInclusive(0, keysToGet.length);
						// }
						keys.push(keysToGet[index]); 
						// console.log("This is the value" + apparel[keys[index]]); 
						values.push(apparel[keysToGet[index]].toFixed(2)); 

					} 

				 	

					var data = {
					    labels: ["Fast 	Food", "Fine Dining", "Online Apparel", "Online Electronics", "Online Merchandise", "Online Home Goods", "Online Sporting Goods", "Computer Hardware", "Apparel"],
					    datasets: [
					        {
					            label: "My Expenditures",
					            fillColor: "rgba(220,220,220,0.2)",
					            strokeColor: "#fff",
					            pointColor: "#fff",
					            pointStrokeColor: "#fff",
					            pointHighlightFill: "#fff",
					            pointHighlightStroke: "#fff",
					            data: populatedData
					        }
					    ]
					};

					var options = {
					    //Boolean - Whether to show lines for each scale point
					    scaleShowLine : true,

					    //Boolean - Whether we show the angle lines out of the radar
					    angleShowLineOut : false,

					    //Boolean - Whether to show labels on the scale
					    scaleShowLabels : false,

					    // Boolean - Whether the scale should begin at zero
					    scaleBeginAtZero : true,
					    scaleFontColor: "#fff",

					    //String - Colour of the angle line
					    angleLineColor : "rgba(220,220,220,0.2)",

					    //Number - Pixel width of the angle line
					    angleLineWidth : 1,

					    //String - Point label font declaration
					    pointLabelFontFamily : "'Arial'",

					    //String - Point label font weight
					    pointLabelFontStyle : "normal",

					    //Number - Point label font size in pixels
					    pointLabelFontSize : 10,

					    //String - Point label font colour
					    pointLabelFontColor : "#fff",

					    //Boolean - Whether to show a dot for each point
					    pointDot : true,

					    //Number - Radius of each point dot in pixels
					    pointDotRadius : 3,

					    //Number - Pixel width of point dot stroke
					    pointDotStrokeWidth : 1,

					    //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
					    pointHitDetectionRadius : 20,

					    //Boolean - Whether to show a stroke for datasets
					    datasetStroke : true,

					    //Number - Pixel width of dataset stroke
					    datasetStrokeWidth : 2,

					    //Boolean - Whether to fill the dataset with a colour
					    datasetFill : true,

					    //String - A legend template
					    legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].strokeColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"
					}; 


					var data1 = {
							    labels: keys,
							    datasets: [
							        {
							            label: "Purchases",
							            fillColor: "rgba(220,220,220,0.5)",
							            strokeColor: "#fff",
							            highlightFill: "#fff",
							            highlightStroke: "#fff",
							            data: values
							        }
							    ]
							};

					var options1 = {
						    //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
						    scaleBeginAtZero : true,

						    //Boolean - Whether grid lines are shown across the chart
						    scaleShowGridLines : true,

						    //String - Colour of the grid lines
						    scaleGridLineColor : "rgba(0,0,0,.05)",

						    //Number - Width of the grid lines
						    scaleGridLineWidth : 1,
						    scaleFontColor: "#fff",

						    //Boolean - Whether to show horizontal lines (except X axis)
						    scaleShowHorizontalLines: true,

						    //Boolean - Whether to show vertical lines (except Y axis)
						    scaleShowVerticalLines: true,

						    //Boolean - If there is a stroke on each bar
						    barShowStroke : true,

						    //Number - Pixel width of the bar stroke
						    barStrokeWidth : 2,

						    //Number - Spacing between each of the X value sets
						    barValueSpacing : 5,

						    //Number - Spacing between data sets within X values
						    barDatasetSpacing : 1,

						    //String - A legend template
						    legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].fillColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"
						};

				// Get context with jQuery - using jQuery's .get() method.
				var ctx = $("#myChart").get(0).getContext("2d");
				var ctx1 = $("#myChart1").get(0).getContext("2d");
				var myNewChart = new Chart(ctx).Radar(data, options);
				var myBarChart = new Chart(ctx1).Bar(data1, options1);
					}); 
				

			</script>

			<script>
				function category(cat){

					$.getJSON('/purchases', function(data) {


					var fastFood = {};
					var fineDining = {};
					var apparelOnline = {};
					var electronicsOnline = {};
					var merchandiseOnline = {};
					var homeGoodsOnline = {};
					var sportingGoodsOnline = {};
					var hardware = {};
					var apparel = {};
					for(i = 0; i < data.length; i++) {
							switch(data[i]['description']) {
								case "fastFood": 
								    if(fastFood.hasOwnProperty(data[i]['name'])){
								    	var cost = fastFood['name']; 
								    	fastFood[data[i]['name']]  = cost += data[i]['price']; 
									}
									else {
										fastFood[data[i]['name']]  = data[i]['price']; 
									}
								case "fineDining": 
								    if(fineDining.hasOwnProperty(data[i]['name'])){
								    	var cost = fastFood['name']; 
								    	fineDining[data[i]['name']]  = cost += data[i]['price']; 
									}
									else {
										fineDining[data[i]['name']]  = data[i]['price']; 
									}
								case "apparelOnline":
								    if(apparelOnline.hasOwnProperty(data[i]['name'])){
								    	var cost = fastFood['name']; 
								    	apparelOnline[data[i]['name']]  = cost += data[i]['price']; 
									}
									else {
										apparelOnline[data[i]['name']]  = data[i]['price']; 
									}
								case "electronicsOnline": 
								    if(electronicsOnline.hasOwnProperty(data[i]['name'])){
								    	var cost = fastFood['name']; 
								    	electronicsOnline[data[i]['name']]  = cost += data[i]['price']; 
									}
									else {
										electronicsOnline[data[i]['name']]  = data[i]['price']; 
									}
								case "merchandiseOnline": 
								    if(merchandiseOnline.hasOwnProperty(data[i]['name'])){
								    	var cost = fastFood['name']; 
								    	merchandiseOnline[data[i]['name']]  = cost += data[i]['price']; 
									}
									else {
										merchandiseOnline[data[i]['name']]  = data[i]['price']; 
									}
								case "homeGoodsOnline": 
								    if(homeGoodsOnline.hasOwnProperty(data[i]['name'])){
								    	var cost = fastFood['name']; 
								    	homeGoodsOnline[data[i]['name']]  = cost += data[i]['price']; 
									}
									else {
										homeGoodsOnline[data[i]['name']]  = data[i]['price']; 
									}
								case "sportingGoodsOnline": 
								    if(sportingGoodsOnline.hasOwnProperty(data[i]['name'])){
								    	var cost = fastFood['name']; 
								    	sportingGoodsOnline[data[i]['name']]  = cost += data[i]['price']; 
									}
									else {
										sportingGoodsOnline[data[i]['name']]  = data[i]['price']; 
									}
								case "hardware": 
								    if(hardware.hasOwnProperty(data[i]['name'])){
								    	var cost = fastFood['name']; 
								    	hardware[data[i]['name']]  = cost += data[i]['price']; 
									}
									else {
										hardware[data[i]['name']]  = data[i]['price']; 
									}
								case "apparel": 
								    if(apparel.hasOwnProperty(data[i]['name'])){
								    	var cost = fastFood['name']; 
								    	apparel[data[i]['name']]  = cost += data[i]['price']; 
									}
									else {
										apparel[data[i]['name']]  = data[i]['price']; 
									}
						}
					}

					$('#mytable tr').remove();

					var ctx1 = $("#myChart1").get(0).getContext("2d");
					var myBarChart = new Chart(ctx1).Bar(data1, options1);
					}); 
					myBarChart.removeData();

        			$.each(data, function(i, item) {
        						if (item.description == cat){
			    					$row = $('<tr></tr>');
			    					$row.append('<td>' + item.name.charAt(0).toUpperCase() + item.name.slice(1) + '</td>');
									$row.append('<td>' + "$" + parseInt(item.price).toFixed(2) + '</td>');
									$row.append('<td>' + new Date(item.date) + '</td>');
									// repeat the above line for each data item
									$('#mytable').append($row);
						}
					})

					});
				}


					$.getJSON('/purchases', function(data) {

					$('#mytable tr').remove();
					var total = 0;
    
        					$.each(data, function(i, item) {
        							total += parseInt(item.price);

		    					$row = $('<tr></tr>');
		    					$row.append('<td>' + item.name.charAt(0).toUpperCase() + item.name.slice(1) + '</td>');
							$row.append('<td>' + "$" + parseInt(item.price).toFixed(2) + '</td>');
							$row.append('<td>' + new Date(item.date) + '</td>');

							// repeat the above line for each data item

							$('#mytable').append($row);
					})

        					$('#total').append(total);


					});



				
				var food = []
				var retail = []
				var online = []
				$.getJSON('/purchases', function(data) {
    					//data is the JSON string
    					
    					for(i = 0; i < data.length;i++) {
    						// console.log(data[i]); 
    					}

    					for(i = 0; i < 10; i++) {
    						food.push(data[i])
    					}

    					for(i = 10; i < 20; i++) {
    						retail.push(data[i])
    					}

    					for(i = 10; i < 20; i++) {
    						online.push(data[i])
    					}

    					// convC1Data("#dashboard", food, online, retail)
				});



			</script>

	</body>

				<!-- Footer -->
			<footer id="footer">
<!-- 				<ul class="icons">
					<li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
					<li><a href="#" class="icon fa-github"><span class="label">GitHub</span></a></li>
					<li><a href="#" class="icon fa-envelope-o"><span class="label">Email</span></a></li>
				</ul> -->
				<ul class="copyright">
					<li>&copy; flex <br>Made with <i class="fa fa-heart"></i> at VT Hacks III </li><li><br>John Purviance | Jayanth Prathipati | Oliver Ebeling-Koning | Dag Yeshiwas</li>
				</ul>
			</footer>

</html>
